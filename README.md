# ssz-ts

Simple Serialize (SSZ)

## Install

`npm install @chainsafe/ssz`

## Usage

See [API.md](docs/API.md) for the autogenerated API docs.

In order to properly serialize/deserialize/hash values, we need to know the "type" of the value.

### Types

The simple serialization spec only operates over a specific few types.

#### Uint
A uint serialization value may be either a js `number` or a `BN` from [bn.js](https://github.com/indutny/bn.js).
A uint type is specified by either `"uintN"` or `"numberN"`, where N is the number of bits to serialize.
`uintN` > 32 bits is deserialized to a `BN` else deserialized to a `number`.
Every `numberN` is deserialized to a number.

#### Boolean
A boolean serialization value must be either `true` or `false`. Anything other input will throw an `Error`.
The boolean type is specified as `"bool"`.

#### Tuple
A "tuple" according to the spec is a fixed-length list with every element of the same type.
A tuple serialization value may be either an `Array` or `Buffer`.
Tuple types are specified as either `"bytesN"` or `[elementType, tupleLength]`
`bytesN` is deserialized to `Buffer`.
`[elementType, tupleLength]` is deserialized to `Array<elementType>` unless elementType is `byte`, when the value is deserialized to `Buffer`.

#### List
A "list" according to the spec is a list of unspecified length with every element of the same type.
A list serialization value may be either an `Array` or `Buffer`.
Tuple types are specified as either `"bytes"` or `[elementType]`
`bytes` is deserialized to `Buffer`.
`[elementType]` is deserialized to `Array<elementType>` unless elementType is `byte`, when the value is deserialized to `Buffer`.

#### Container
A "container" according to the spec is a collection of values where the type of each element may differ.
A container serialization value must be an `Object`.
The container serialization type must be an `Object`, with a `fields` value of `Array<[fieldName, fieldType]>.

## Examples

### Serialize:

#### Array
```typescript
let array = [1, 2, 3]
let serialized = ssz.serialize(array, ['uint16'])
```

#### Boolean
```typescript
let bool = true
let serialized = ssz.serialize(bool, 'bool')
```

#### Number
```typescript
let num = 16
let serialized = ssz.serialize(num, 'uint32')
```

#### BN (Big Number)
```typescript
const BN = require('bn.js')
let num = new BN(0xFFFFFFFFFFFFFFF0)
let searialized = ssc.serialize(num, 'uint64')
```

Note: Any value greater than `2^53 - 1` should be stored in a [BN](https://github.com/indutny/bn.js)

#### Bytes
```typescript
let bytes = Buffer.from([1,2,3])
let serialized = ssz.serialize(bytes, 'bytes')
```

With `bytesN`:
```typescript
// Note: N === bytes.length
let bytes = Buffer.from([1, 2, 3, 4])
let serialized = ssz.serialize(bytes, 'bytes4')
```

#### Object
```typescript
let obj = {
	a: Buffer.from('hello'),
	b: 10,
	c: false
}

let types = {
	'fields' : [
		['a', 'bytes'],
		['b', 'int16'],
		['c', 'bool'],
	]
}

let serialized = ssz.serialize(obj, types)
```

### Deserialize

For deserialization we need to specify:
- data {buffer} - encoded data
- type {string | object | array} - type of data we want to decode, same as encoding types
- start {number} - optional, default: 0, start location in the data buffer from where we wish to read
```typescript
// eg. deserialize a boolean at position 0
ssz.deserialize(buf, 'bool')
```
```typescript
// eg. deserialize an object at position 32
let types = {
    'fields' : [
        ['a', 'bool'],
        ['b', 'uint8']
    ]
}
ssz.deserialize(buf, types, 32)
```

### License

MIT
